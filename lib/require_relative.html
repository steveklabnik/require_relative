<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>require_relative.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="require_relative.html">require_relative.rb</a>
          <a class="source" href="require_relative/version.html">version.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>require_relative.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        <p>This is the source code for require_relative, a Ruby gem that backports that
particular feature to Ruby 1.8.</p>

<p>Please check out the <a href="https://github.com/steveklabnik/require_relative/blob/master/README.md">README</a>
for more information on how to build your own copy of the gem, as well as
contribute fixes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>require<em>relative has no effect on Ruby 1.9 (or other versions that provide Kernel#require</em>relative
out of the box)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">unless</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:require_relative</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>Yep, you&rsquo;re looking at it! This gem is pretty small, and for good reason.
There&rsquo;s not much to do! We use split to find the filename that we&rsquo;re
looking to require, raise a LoadError if it&rsquo;s called in a context (like eval)
that it shouldn&rsquo;t be, and then require it via regular old require.</p>

<p>Now, in 1.9, &ldquo;.&rdquo; is totally removed from the $LOAD_PATH. We don&rsquo;t do that
here, because that would break a lot of other code! You&rsquo;re still vulnerable
to the security hole that caused this change to happen in the first place.
You will be able to use this gem to transition the code you write over to
the 1.9 syntax, though.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">def</span> <span class="nf">require_relative</span><span class="p">(</span><span class="n">relative_feature</span><span class="p">)</span>

    <span class="n">file</span> <span class="o">=</span> <span class="nb">caller</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/:\d/</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>

    <span class="k">raise</span> <span class="no">LoadError</span><span class="p">,</span> <span class="s2">&quot;require_relative is called in </span><span class="si">#{</span><span class="vg">$1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span><span class="sr"> /\A\((.*)\)/</span> <span class="o">=~</span> <span class="n">file</span>

    <span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="n">relative_feature</span><span class="p">,</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
